import { ReactPortal } from '@/shared/lib/ReactPortal';
import { FC, SVGProps, useEffect, useRef, useState } from 'react';

type SettingsIconProps = SVGProps<SVGSVGElement>;

export const SettingsIcon: FC<SettingsIconProps> = ({ ...props }) => {
  const wrapper = useRef<HTMLDivElement>(null);
  const [notificationPosition, setNotificationPosition] = useState<{
    x: number;
    y: number;
  } | null>(null);

  useEffect(() => {
    const wrapperRect = wrapper.current?.getBoundingClientRect();
    if (wrapperRect) {
      setNotificationPosition({
        x: wrapperRect.left + 12,
        y: wrapperRect.top - 12,
      });
    }
  }, []);

  return (
    <div className="relative" ref={wrapper}>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" {...props}>
        <path
          fillRule="evenodd"
          fill="#fff"
          d="M22.646 14.14a67.54 67.54 0 0 1-1.36.19.135.135 0 0 0-.115.096 9.561 9.561 0 0 1-.909 2.194.136.136 0 0 0 .013.149c.281.365.559.734.828 1.097a1.25 1.25 0 0 1-.123 1.616l-1.498 1.498a1.25 1.25 0 0 1-1.616.123 79.04 79.04 0 0 1-1.097-.828.136.136 0 0 0-.149-.013 9.606 9.606 0 0 1-2.194.909.136.136 0 0 0-.096.115 66.55 66.55 0 0 1-.19 1.36 1.25 1.25 0 0 1-1.229 1.056h-2.119a1.25 1.25 0 0 1-1.23-1.056c-.066-.445-.13-.903-.19-1.36a.133.133 0 0 0-.096-.114 9.583 9.583 0 0 1-2.193-.91.137.137 0 0 0-.15.013c-.365.282-.734.56-1.096.828a1.251 1.251 0 0 1-1.617-.122l-1.498-1.499a1.249 1.249 0 0 1-.122-1.616c.268-.363.546-.732.827-1.097a.136.136 0 0 0 .013-.149 9.65 9.65 0 0 1-.909-2.194.136.136 0 0 0-.114-.096 66.55 66.55 0 0 1-1.36-.19A1.25 1.25 0 0 1 0 12.911v-2.119c0-.611.454-1.14 1.057-1.23.446-.066.903-.13 1.36-.19a.135.135 0 0 0 .114-.096 9.662 9.662 0 0 1 .909-2.193.137.137 0 0 0-.013-.15c-.28-.364-.559-.733-.827-1.096a1.25 1.25 0 0 1 .122-1.617L4.22 2.722A1.25 1.25 0 0 1 5.837 2.6c.362.267.731.546 1.096.827a.137.137 0 0 0 .15.013 9.625 9.625 0 0 1 2.193-.909.135.135 0 0 0 .096-.114c.06-.458.124-.915.19-1.36A1.25 1.25 0 0 1 10.792 0h2.119c.61 0 1.139.454 1.229 1.057.067.445.131.902.19 1.36.008.055.045.1.096.114a9.65 9.65 0 0 1 2.194.909.136.136 0 0 0 .149-.013c.366-.281.735-.56 1.097-.827a1.248 1.248 0 0 1 1.616.122L20.98 4.22a1.25 1.25 0 0 1 .123 1.617 80.98 80.98 0 0 1-.828 1.096.137.137 0 0 0-.013.15c.393.69.699 1.429.91 2.193a.132.132 0 0 0 .114.096c.456.06.914.124 1.36.19a1.25 1.25 0 0 1 1.056 1.23v2.119a1.25 1.25 0 0 1-1.056 1.229Zm-.05-3.348a.137.137 0 0 0-.114-.135 64.513 64.513 0 0 0-1.339-.187 1.238 1.238 0 0 1-1.038-.899 8.563 8.563 0 0 0-.805-1.942 1.239 1.239 0 0 1 .098-1.37c.277-.36.551-.723.815-1.08a.137.137 0 0 0-.015-.176L18.7 3.505a.136.136 0 0 0-.176-.015c-.356.263-.72.537-1.08.815a1.24 1.24 0 0 1-1.371.097 8.533 8.533 0 0 0-1.941-.804 1.24 1.24 0 0 1-.899-1.038 80.276 80.276 0 0 0-.187-1.34.137.137 0 0 0-.135-.113h-2.119a.137.137 0 0 0-.135.113c-.066.439-.129.889-.187 1.34a1.24 1.24 0 0 1-.9 1.038 8.552 8.552 0 0 0-1.941.804 1.24 1.24 0 0 1-1.371-.097c-.36-.278-.723-.552-1.08-.815a.134.134 0 0 0-.175.015L3.505 5.003a.136.136 0 0 0-.015.176c.264.357.538.721.815 1.08.306.398.344.936.097 1.37a8.514 8.514 0 0 0-.804 1.942 1.24 1.24 0 0 1-1.038.899c-.45.058-.9.121-1.34.187a.137.137 0 0 0-.113.135v2.119c0 .067.049.125.113.135.44.065.89.128 1.34.187a1.24 1.24 0 0 1 1.038.899c.186.677.457 1.33.804 1.941a1.24 1.24 0 0 1-.097 1.371c-.277.36-.552.723-.815 1.08a.136.136 0 0 0 .015.176l1.498 1.498a.136.136 0 0 0 .176.015c.356-.263.719-.538 1.08-.815a1.242 1.242 0 0 1 1.37-.098 8.555 8.555 0 0 0 1.941.805c.482.132.835.54.9 1.038.058.45.121.901.187 1.339.01.065.068.114.135.114h2.119a.135.135 0 0 0 .134-.114c.066-.438.129-.889.188-1.339.065-.498.418-.906.899-1.038a8.536 8.536 0 0 0 1.941-.805 1.24 1.24 0 0 1 1.371.098c.36.277.724.551 1.08.815a.136.136 0 0 0 .176-.015l1.498-1.498a.137.137 0 0 0 .015-.176c-.264-.357-.538-.72-.815-1.08a1.24 1.24 0 0 1-.098-1.371 8.488 8.488 0 0 0 .804-1.941 1.24 1.24 0 0 1 1.039-.899c.449-.059.9-.122 1.339-.187a.137.137 0 0 0 .114-.135v-2.119Zm-10.745 6.204a5.15 5.15 0 0 1-5.145-5.145 5.15 5.15 0 0 1 5.145-5.145 5.15 5.15 0 0 1 5.145 5.145 5.15 5.15 0 0 1-5.145 5.145Zm0-9.183a4.043 4.043 0 0 0-4.038 4.038 4.043 4.043 0 0 0 4.038 4.038 4.042 4.042 0 0 0 4.038-4.038 4.043 4.043 0 0 0-4.038-4.038Z"
        />
      </svg>
      {notificationPosition && (
        <ReactPortal>
          <span
            className="absolute grid size-6 place-items-center rounded-full bg-orange-500 leading-none"
            style={{
              top: notificationPosition.y,
              left: notificationPosition.x,
            }}
          >
            2
          </span>
        </ReactPortal>
      )}
    </div>
  );
};
